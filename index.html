<!DOCTYPE html>
<html>

<head>
    <title>Stylist</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<table border="1" style="border-collapse: collapse;">
    <tr>
        <td style="vertical-align: top; width: 100%;">
            <table border="0" style="border-collapse: collapse;  width: 100%; height: 100%;">
                <tr>
                    <td>Fej-áll hossz:</td>
                    <td><input id="head_chin_length"></input></td>
                </tr>
                <tr>
                    <td>Fej - mellcsúcs hossz:</td>
                    <td><input id="head_bust_length"></input></td>
                </tr>
                <tr>
                    <td>Fej - derék hossz:</td>
                    <td><input id="head_waist_length"></input></td>
                </tr>
                <tr>
                    <td>Fej - gát hossz:</td>
                    <td><input id="head_inseam_length"></input></td>
                </tr>
                <tr>
                    <td>Gát magasság:</td>
                    <td><input id="inseam_height"></input></td>
                </tr>
                <tr>
                    <td>Mell bőség:</td>
                    <td><input id="bust_length"></input></td>
                </tr>
                <tr>
                    <td>Mell alatti bőség:</td>
                    <td><input id="under_bust_length"></input></td>
                </tr>
                <tr>
                    <td>Lábszár hossz:</td>
                    <td><input id="lowerleg_length"></input></td>
                </tr>
                <tr>
                    <td>Váll szélesség:</td>
                    <td><input id="shoulder_width"></input></td>
                    <td><input id="shoulder_meta" readonly="true"></input></td>
                </tr>
                <tr>
                    <td>Csípő szélesség:</td>
                    <td><input id="hip_width"></input></td>
                    <td><input id="hip_meta" readonly="true"></input></td>
                </tr>
                <tr>
                    <td>Derék bőség:</td>
                    <td><input id="waist_length"></input></td>
                </tr>
                <tr>
                    <td>Csípő bőség:</td>
                    <td><input id="hip_length"></input></td>
                </tr>
                <tr>
                    <td>Ujj:</td>
                    <td><input id="fingers"></input></td>
                    <td><input id="fingers_meta" readonly="true"></input></td>
                </tr>
                <tr>
                    <td><br></td>
                </tr>
                <tr>
                    <td>Test magasság:</td>
                    <td><input id="height" readonly="true"></input></td>
                    <td><input id="height_meta" readonly="true"></input></td>
                </tr>
                <tr>
                    <td>Mell/fej arány:</td>
                    <td><input id="bust_head_ratio" readonly="true"></input></td>
                </tr>
                <tr>
                    <td>Láb/fej arány:</td>
                    <td><input id="leg_head_ratio" readonly="true"></input></td>
                </tr>
                <tr>
                    <td>Derék/fej arány:</td>
                    <td><input id="waist_head_ratio" readonly="true"></input></td>
                </tr>
                <tr>
                    <td>Felsőtest hossza:</td>
                    <td><input id="upper_body" readonly="true"></input></td>
                    <td><input id="upper_body_meta" readonly="true"></input></td>
                    <td><input id="upper_body_meta2" readonly="true"></input></td>
                </tr>
                <tr>
                    <td>Alsótest hossza:</td>
                    <td><input id="lower_body" readonly="true"></input></td>
                    <td><input id="lower_body_meta" readonly="true"></input></td>
                    <td><input id="lower_body_meta2" readonly="true"></input></td>
                </tr>
                <tr>
                    <td>Derék bőség/csípő bőség arány:</td>
                    <td><input id="waist_hip_ratio" readonly="true"></input></td>
                    <td><input id="waist_hip_ratio_meta" readonly="true"></input></td>
                </tr>
                <tr>
                    <td>Váll szélesség/csípő szélesség arány:</td>
                    <td><input id="shoulder_hip_ratio" readonly="true"></input></td>
                </tr>
                <tr>
                    <td>Melltartóméret:</td>
                    <td><input id="bra_size" readonly="true"></input></td>
                </tr>
                <tr>
                    <td>Kosárméret:</td>
                    <td><input id="cup_size" readonly="true"></input></td>
                    <td><input id="cup_size_meta" readonly="true"></input></td>
                </tr>
            </table>
        </td>
    </tr>
</table>
<script>
    let attributes = []
    let measuredValues = []

    const updateFunc = function () {
        attributes.forEach(element => {
            element.Set("")
        });
        attributes.forEach(element => {
            element.refresh()
        });
    }

    class MeasuredValue {
        constructor(sourceId, highlights) {
            this.sourceId = sourceId
            this.highlights = highlights
            measuredValues.push(this)
            let element = document.getElementById(this.sourceId)
            element.addEventListener("change", updateFunc)
            element.addEventListener("focus", () => this.onFocus())
            element.addEventListener("blur", () => this.onBlur())
        }

        getValue() {
            let element = document.getElementById(this.sourceId)
            let value = element.value
            //console.log("%s %s", this.sourceId, element.value)
            value = value.replace(",", ".")
            return parseFloat(value)
        }

        onFocus() {
            console.log("%s focus", this.sourceId)
            for (var i = 1; i <= 8; i++) {
                if (this.highlights.includes(i)) {
                    document.getElementById("highlight" + i).style.backgroundColor = "#dd6ddd"
                } else {
                    document.getElementById("highlight" + i).style.backgroundColor = "#FFFFFF"
                }
            }
        }

        onBlur() {
            console.log("%s blur", this.sourceId)
        }
    }

    class DisplayedAttribute {
        constructor(targetId) {
            this.targetId = targetId
            attributes.push(this)
        }

        Set(value) {
            if (typeof value === 'string' && value != "NaN") {
                document.getElementById(this.targetId).value = value
            }
            if (isNaN(value)) {
                return
            }
            document.getElementById(this.targetId).value = value
        }

        refresh() {
        }
    }

    let headChinLengthValue = new MeasuredValue("head_chin_length", [1])
    let headBustLengthValue = new MeasuredValue("head_bust_length", [1, 2])
    let headWaistLengthValue = new MeasuredValue("head_waist_length", [1, 2, 3])
    let headInseamLengthValue = new MeasuredValue("head_inseam_length", [1, 2, 3, 4])
    let inseamHeightValue = new MeasuredValue("inseam_height", [5, 6, 7, 8])
    let bustLengthValue = new MeasuredValue("bust_length", [])
    let underBustLengthValue = new MeasuredValue("under_bust_length", [])
    let lowerLegLengthValue = new MeasuredValue("lowerleg_length", [7, 8])
    let shoulderWidthValue = new MeasuredValue("shoulder_width", [])
    let hipWidthValue = new MeasuredValue("hip_width", [])
    let waistLengthValue = new MeasuredValue("waist_length", [])
    let hipLengthValue = new MeasuredValue("hip_length", [])
    let fingersValue = new MeasuredValue("fingers", [])

    let heightAttribute = new DisplayedAttribute("height_meta")
    let heightValue = new DisplayedAttribute("height")
    heightValue.refresh = function () {
        let v = headInseamLengthValue.getValue() + inseamHeightValue.getValue()
        heightValue.Set(v)
        if (isNaN(v)) {
            return
        }
        if (v > 173) {
            heightAttribute.Set("tall")
        } else if (v < 163) {
            heightAttribute.Set("petite")
        } else {
            heightAttribute.Set("normál")
        }
    }

    let bustHeadRatio = new DisplayedAttribute("bust_head_ratio")
    bustHeadRatio.refresh = function () {
        let v = (headBustLengthValue.getValue() / headChinLengthValue.getValue()).toPrecision(3)
        bustHeadRatio.Set(v)
    }

    let legHeadRatio = new DisplayedAttribute("leg_head_ratio")
    legHeadRatio.refresh = function () {
        let v = (lowerLegLengthValue.getValue() / headChinLengthValue.getValue()).toPrecision(3)
        legHeadRatio.Set(v)
    }

    let waistHeadRatio = new DisplayedAttribute("waist_head_ratio")
    waistHeadRatio.refresh = function () {
        let v = (headWaistLengthValue.getValue() / headChinLengthValue.getValue()).toPrecision(3)
        waistHeadRatio.Set(v)
    }

    let upperBody = new DisplayedAttribute("upper_body")
    upperBody.refresh = function () {
        upperBody.Set(headInseamLengthValue.getValue())
    }

    let lowerBody = new DisplayedAttribute("lower_body")
    lowerBody.refresh = function () {
        lowerBody.Set(inseamHeightValue.getValue())
    }

    let upperBodyMeta = new DisplayedAttribute("upper_body_meta")
    let upperBodyMeta2 = new DisplayedAttribute("upper_body_meta2")
    upperBodyMeta.refresh = function () {
        let diff = headInseamLengthValue.getValue() - inseamHeightValue.getValue()
        if (diff > 0) {
            upperBodyMeta.Set(`hosszabb ${diff} cm-rel`)
            if (diff > 15) {
                upperBodyMeta2.Set("szignifikáns")
            }
        }
    }
    let lowerBodyMeta = new DisplayedAttribute("lower_body_meta")
    let lowerBodyMeta2 = new DisplayedAttribute("lower_body_meta2")
    lowerBodyMeta.refresh = function () {
        diff = inseamHeightValue.getValue() - headInseamLengthValue.getValue()
        if (diff > 0) {
            upperBodyMeta.Set(`hosszabb ${diff} cm-rel`)
            if (diff > 15) {
                lowerBodyMeta2.Set("szignifikáns")
            }
        }
    }
    let fingersMeta = new DisplayedAttribute("fingers_meta")
    fingersMeta.refresh = function () {
        if (isNaN(fingersValue.getValue())) {
            return
        }
        if (fingersValue.getValue() >= 8) {
            fingersMeta.Set("hosszú")
        } else {
            fingersMeta.Set("rövid/magas")
        }
    }
    let braSize = new DisplayedAttribute("bra_size")
    braSize.refresh = function () {
        let under_bust_length_value = underBustLengthValue.getValue()
        if (isNaN(under_bust_length_value)) {
            return
        }
        if (under_bust_length_value < 60) {
            braSize.Set("60-nál kisebb")
        }
        if (under_bust_length_value >= 60 && under_bust_length_value < 65) {
            braSize.Set("60")
        }
        if (under_bust_length_value >= 65 && under_bust_length_value < 70) {
            braSize.Set("65")
        }
        if (under_bust_length_value >= 70 && under_bust_length_value < 75) {
            braSize.Set("70")
        }
        if (under_bust_length_value >= 75 && under_bust_length_value < 80) {
            braSize.Set("75")
        }
        if (under_bust_length_value >= 80 && under_bust_length_value < 85) {
            braSize.Set("80")
        }
        if (under_bust_length_value >= 85 && under_bust_length_value < 90) {
            braSize.Set("85")
        }
        if (under_bust_length_value >= 90 && under_bust_length_value < 95) {
            braSize.Set("90")
        }
        if (under_bust_length_value >= 95 && under_bust_length_value < 100) {
            braSize.Set("95")
        }
        if (under_bust_length_value >= 100 && under_bust_length_value < 105) {
            braSize.Set("100")
        }
        if (under_bust_length_value >= 105) {
            braSize.Set("105-nél nagyobb")
        }
    }
    let cupSize = new DisplayedAttribute("cup_size")
    let cupSizeMeta = new DisplayedAttribute("cup_size_meta")
    cupSize.refresh = function () {
        let value = (bustLengthValue.getValue() - underBustLengthValue.getValue()).toPrecision(3)
        cupSize.Set(value)
    }

    cupSizeMeta.refresh = function () {
        let value = (bustLengthValue.getValue() - underBustLengthValue.getValue()).toPrecision(3)
        if (value < 12) {
            cupSizeMeta.Set("AA vagy AAA")
        }
        if (value >= 12 && value < 14) {
            cupSizeMeta.Set("A")
        }
        if (value >= 14 && value < 16) {
            cupSizeMeta.Set("B")
        }
        if (value >= 16 && value < 18) {
            cupSizeMeta.Set("C")
        }
        if (value >= 18 && value < 20) {
            cupSizeMeta.Set("D")
        }
        if (value >= 20 && value < 22) {
            cupSizeMeta.Set("E")
        }
        if (value >= 22 && value < 24) {
            cupSizeMeta.Set("F")
        }
        if (value >= 26 && value < 27) {
            cupSizeMeta.Set("H")
        }
        if (value >= 27) {
            cupSizeMeta.Set("nagyobb mint H")
        }
    }

    let waistHipRatio = new DisplayedAttribute("waist_hip_ratio")
    waistHipRatio.refresh = function () {
        waistHipRatio.Set((waistLengthValue.getValue() / hipLengthValue.getValue()).toPrecision(3))
    }
    let waistHipRatioMeta = new DisplayedAttribute("waist_hip_ratio_meta")
    waistHipRatioMeta.refresh = function () {
        let waistHipRatioValue = (waistLengthValue.getValue() / hipLengthValue.getValue()).toPrecision(3)
        if (isNaN(waistHipRatioValue)) {
            return
        }
        if (waistHipRatioValue > 0.72) {
            waistHipRatioMeta.Set("enyhén definiált")
        } else {
            waistHipRatioMeta.Set("erősen definiált")
        }
    }

    let shoulderHipRatio = new DisplayedAttribute("shoulder_hip_ratio")
    shoulderHipRatio.refresh = function () {
        shoulderHipRatio.Set((shoulderWidthValue.getValue() / hipWidthValue.getValue()).toPrecision(3))
    }
    let shoulderMeta = new DisplayedAttribute("shoulder_meta")
    shoulderMeta.refresh = function () {
        shoulder = parseFloat(shoulder_width.value)
        hip = parseFloat(hip_width.value)
        if (shoulderWidthValue.getValue() > hipWidthValue.getValue()) {
            shoulderMeta.Set("nagyobb")
        }
    }
    let hipMeta = new DisplayedAttribute("hip_meta")
    hipMeta.refresh = function () {
        shoulder = parseFloat(shoulder_width.value)
        hip = parseFloat(hip_width.value)
        if (shoulderWidthValue.getValue() < hipWidthValue.getValue()) {
            hipMeta.Set("nagyobb")
        }
    }
</script>

</html>